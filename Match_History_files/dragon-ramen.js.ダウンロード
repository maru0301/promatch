JSoop.define("DragonRamen",{mixins:{observable:"JSoop.mixins.Observable"},singleton:true,versions:{},versionCache:{},loadQueue:[],timeouts:{},cdn:"",isStarted:false,constructor:function(){var a=this;a.initMixin("observable");Riot.DDragon.addApp([],function(){a.cdn=Riot.DDragon.m.cdn.replace("http:","").replace(/\/$/,"");Riot.DDragon.fn.fire.plan("model",{},JSoop.bind(a.onModelLoad,a));a.isStarted=true;a.fireEvent("init",a);JSoop.each(a.loadQueue,function(b){a.load(b.model,b.version)})})},load:function(b,a){var c=this;a=c.getVersion(a);if(Riot.DDragon.models){Riot.DDragon.useModel(b,a);c.createDisplay(b,a)}else{c.loadQueue.push({model:b,version:a})}},createDisplay:function(b,a){Riot.DDragon.addDisplay({type:b+"_"+a+"_tooltip",success:Riot.DDragon.display[b+"_tooltip"].success})},get:function(b,a,f){var d=this,e=d.getCollection(b,a),c=parseInt(f,10);if(!isNaN(c)){return e.get(c)}return e.get(f)},getCollection:function(b,a){var c=this;if(b==="summoner"){b="spell"}a=c.getVersion(a);if(!c.versions[a]){c.versions[a]={}}if(!c.versions[a][b]){c.versions[a][b]=c.createCollection(b,a)}return c.versions[a][b]},createCollection:function(b,a){var c="DragonRamen.collection.";switch(b){case"champion":c=c+"Champions";break;case"item":c=c+"Items";break;case"rune":c=c+"Runes";break;case"summoner":c=c+"Spells";break;case"spell":c=c+"Spells";break;default:return}return JSoop.create(c,[],{version:a})},getVersion:(function(){function a(f,e,d){var c=-1;if(f===null){return e.latest}if(d===undefined){d=999}f=parseInt(f,10);JSoop.each(e.versions,function(g){if(g>c&&g<=f&&(g<d)){c=g}});return c}function b(c){var d=DragonRamen.versionCache;if(c.major===-1){c.season=a(c.season,d,c.season);c.major=a(null,d[c.season]);c.minor=a(null,d[c.season][c.major])}if(c.minor===-1){c.minor=a(null,d[c.season][c.major])}}return function(d){var f=DragonRamen.versionCache,i=d?d.split("."):[null,null,null],h=a(i[0],f),e=a(i[1],f[h]),g=a(i[2],f[h][e]),c={season:h,major:e,minor:g};b(c);return c.season+"."+c.major+"."+c.minor}}()),onModelLoad:function(e,c){var d=this,a=c.name,b=Riot.DDragon.models[a];d.fireEvent("load",a,b)}},function(c){var a={versions:[]};function b(d,e){d=parseInt(d,10);if(e.versions.indexOf(d)===-1){e.versions.push(d)}if(!e[d]){e[d]={versions:[]}}e.versions.sort(function(g,f){return f-g});e.latest=e.versions[0]}JSoop.each(Riot.DDragon.versions,function(d){var e=d.split(".");if(d.indexOf("lolpatch")!==-1){return}b(e[0],a);b(e[1],a[e[0]]);b(e[2],a[e[0]][e[1]])});c.versionCache=a});JSoop.define("DragonRamen.model.Champion",{extend:"Ramen.data.Model",name:"Champion",fields:["blurb","id","dragonId","image","info",{name:"key",type:"int",convert:function(e,d,c){var a,b;if(!e){return}if(!c.creating){a=DragonRamen.versions[c.version].champion;b=a.indexOfKey(e);c=JSoop.clone(c);c.id=parseInt(e,10);c.creating=true;if(b===-1){a.add(c)}else{a.at(b).set(c)}}return undefined}},{name:"name",defaultValue:""},"partype","tags","title","version","searchName","searchHash","searchRaw","searchString","skins","lore","allytips","enemytips","passive","recommended"],associations:[{type:"hasOne",name:"Stats",model:"DragonRamen.model.Stats",foreignKey:"championId",mapping:"stats"},{type:"hasMany",name:"Skills",model:"DragonRamen.model.Skill",foreignKey:"championId",mapping:"spells"}],getStats:function(){var a=this;if(!a.stats){a.stats=JSoop.create("DragonRamen.model.Stats",{getChampion:function(){return a}})}return a.stats},getSkills:function(){var a=this;if(!a.skills){a.skills=JSoop.create("Ramen.data.Collection",[],{model:"DragonRamen.model.Skill"})}return a.skills},getFull:function(){var a=this;if(a.isLoadedFull||a.isLoading){return}if(!a.get("dragonId")){a.on("change:dragonId",a.getFull,a,{single:true});return}Riot.DDragon.useModel("champion",a.get("version")).getFull(a.get("dragonId"),undefined,JSoop.bind(a.onFullLoad,a));a.isLoading=true},onFullLoad:function(b){var a=this;a.set(b);a.isLoading=false;a.isLoadedFull=true;a.fireEvent("load:full",a)}});JSoop.define("DragonRamen.model.Item",{extend:"Ramen.data.Model",name:"Item",fields:[{name:"id",type:"int"},"dragonId","colloq","consumeOnFull","consumed","depth","description","from","gold","group","hideFromAll","image","inStore","into","maps","name","parsed","plaintext","requiredChampion","rune","searchHash","searchName","searchRaw","searchString","specialRecipe","stacks","stats","tags","version"]});JSoop.define("DragonRamen.model.Rune",{extend:"Ramen.data.Model",name:"Rune",fields:[{name:"id",type:"int"},"dragonId","colloq","description","image","name","plaintext",{name:"type",mapping:"rune.type"},{name:"tier",mapping:"rune.tier"},"stats","tags","version"]});JSoop.define("DragonRamen.model.Skill",{extend:"Ramen.data.Model",name:"Ability",fields:["id",{name:"dragonId",mapping:"id"},"cooldown","cooldownBurn","cost","costBurn","costType","description","effect","effectBurn","image",{name:"levelTip",mapping:"leveltip"},{name:"maxRank",mapping:"maxrank"},"name","range","rangeBurn","resource","tooltip","vars","version"]});JSoop.define("DragonRamen.model.Stats",{extend:"Ramen.data.Model",name:"Stats",idField:"championId",fields:["championId","armor","armorperlevel","attackdamage","attackdamageperlevel","attackrange","attackspeedoffset","attackspeedperlevel","crit","critperlevel","hp","hpperlevel","hpregen","hpregenperlevel","movespeed","mp","mpperlevel","mpregen","mpregenperlevel","spellblock","spellblockperlevel"]});JSoop.define("DragonRamen.model.Spell",{extend:"Ramen.data.Model",name:"Spell",fields:["dragonId","cooldown","cooldownBurn","cost","costBurn","costType","description","effect","effectBurn","id","image",{name:"key",type:"int",convert:function(e,d,c){var a,b;if(!e){return}if(!c.creating){a=DragonRamen.versions[c.version].spell;b=a.indexOfKey(e);c=JSoop.clone(c);c.id=parseInt(e,10);c.creating=true;if(b===-1){a.add(c)}else{a.at(b).set(c)}}return undefined}},"maxrank","modes","name","range","rangeBurn","resource","summonerLevel","tooltip","vars","version"]});JSoop.define("DragonRamen.collection.Collection",{extend:"Ramen.data.Collection",constructor:function(){var a=this;a.callParent(arguments);setTimeout(function(){if(a.isDataLoaded()){a.load()}else{DragonRamen.on("load",a.load,a);DragonRamen.load(a.dataDragonType,a.version)}},1)},get:function(b){var c=this,a=c.callParent([b]);if(!a){c.add({id:b,version:c.version})}return c.callParent([b])},load:function(){var a=this,c=[],b;if(!a.isDataLoaded()){return}DragonRamen.off("load",a.load,a);b=Riot.DDragon.models[a.dataDragonType+"_"+a.version].data;JSoop.iterate(b,function(d,e){d.version=a.version;if(!d.id){d.id=e}d.dragonId=e;c.push(d)});a.add(c)},isDataLoaded:function(){var a=this;return(Riot.DDragon&&Riot.DDragon.models&&Riot.DDragon.models[a.dataDragonType+"_"+a.version]&&Riot.DDragon.models[a.dataDragonType+"_"+a.version].data)}});JSoop.define("DragonRamen.collection.Champions",{extend:"DragonRamen.collection.Collection",model:"DragonRamen.model.Champion",dataDragonType:"champion"});JSoop.define("DragonRamen.collection.Items",{extend:"DragonRamen.collection.Collection",model:"DragonRamen.model.Item",dataDragonType:"item"});JSoop.define("DragonRamen.collection.Runes",{extend:"DragonRamen.collection.Collection",model:"DragonRamen.model.Rune",dataDragonType:"rune"});JSoop.define("DragonRamen.collection.Spells",{extend:"DragonRamen.collection.Collection",model:"DragonRamen.model.Spell",dataDragonType:"summoner"});JSoop.define("DragonRamen.binding.Icon",{extend:"Ramen.view.binding.ModelBinding",config:{defaults:{tooltip:true,src:"full"}},tpl:["{% if noImage %}",'<div class="no-image"></div>',"{% else %}",'{% if tooltip %}<div data-rg-name="{{ model }}_{{ version }}" data-rg-id="{{ id }}">{% endif %}',"{{ content }}","{% if tooltip %}</div>{% endif %}","{% endif %}"],getImage:function(d,e,a){var c=this,b={};if(e==="full"){b.tag="img";b.src=DragonRamen.cdn+"/"+a+"/img/"+c.dragonModel+"/"+d.full}else{if(e==="sprite"){b.tag="div";b.style={"background-image":"url("+DragonRamen.cdn+"/"+a+"/img/sprite/"+d.sprite+")",height:d.h,width:d.w,"background-position":(d.x*-1)+"px "+(d.y*-1)+"px","background-repeat":"no-repeat"}}}return Ramen.dom.Helper.markup(b)},formatter:function(b){var c=this,d=b.get("image"),a=b.get("version");if(!d){return{noImage:true}}return{tooltip:c.tooltip,model:c.dragonModel,version:a,id:b.get("dragonId"),waiting:false,content:c.getImage(d,c.src,a)}}});JSoop.define("DragonRamen.binding.champion.Icon",{extend:"DragonRamen.binding.Icon",cls:"champion-icon",dragonModel:"champion"});JSoop.define("DragonRamen.binding.item.Icon",{extend:"DragonRamen.binding.Icon",cls:"item-icon",dragonModel:"item"});JSoop.define("DragonRamen.binding.rune.Icon",{extend:"DragonRamen.binding.Icon",cls:"rune-icon",dragonModel:"rune"});JSoop.define("DragonRamen.binding.skill.Icon",{extend:"DragonRamen.binding.Icon",config:{defaults:{tooltip:false}},cls:"skill-icon",dragonModel:"spell"});JSoop.define("DragonRamen.binding.spell.Icon",{extend:"DragonRamen.binding.Icon",cls:"spell-icon",dragonModel:"spell",formatter:function(b){var c=this,e=b.get("image"),a=b.get("version"),d=c.callParent(arguments);d.model="summoner";return d}});